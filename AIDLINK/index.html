<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AidLink - Find Help Near You</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            line-height: 1.6;
            color: #e0e0e0;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: transparent;
            border-radius: 0;
            padding: 40px 30px;
            box-shadow: none;
            animation: fadeIn 0.5s ease-in;
            border: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Floating Emergency Button */
        .emergency-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #ff1a1a 0%, #cc0000 100%);
            border: 3px solid #fff;
            border-radius: 50%;
            color: white;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(255, 26, 26, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: all 0.3s ease;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .emergency-button:hover {
            transform: scale(1.15);
            box-shadow: 0 12px 35px rgba(255, 26, 26, 0.7);
        }
        
        /* Emergency Modal */
        .emergency-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .emergency-modal.active {
            display: flex;
        }
        
        .emergency-modal-content {
            background: #0a0a0a;
            border: 3px solid #ff1a1a;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(255, 26, 26, 0.5);
        }
        
        .emergency-hotline-item {
            background: rgba(255, 26, 26, 0.1);
            border: 2px solid rgba(255, 26, 26, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.2s;
        }
        
        .emergency-hotline-item:hover {
            background: rgba(255, 26, 26, 0.2);
            border-color: #ff1a1a;
        }
        
        .emergency-hotline-number {
            display: inline-block;
            background: #fff;
            color: #ff1a1a;
            padding: 12px 24px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 900;
            font-size: 1.2rem;
            margin-top: 10px;
            transition: all 0.2s;
        }
        
        .emergency-hotline-number:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 26, 26, 0.4);
        }
        
        /* Document Checklist Styles */
        .document-checklist {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid #667eea;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .document-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.2s;
        }
        
        .document-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .document-item input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: #667eea;
        }
        
        .document-item.checked {
            opacity: 0.6;
        }
        
        .document-item.checked label {
            text-decoration: line-through;
            color: #999;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-align: center;
            text-shadow: 0 2px 20px rgba(255,255,255,0.1);
            letter-spacing: -0.02em;
        }
        
        .header p {
            font-weight: 500;
            letter-spacing: -0.01em;
        }
        
        .search-form {
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 20px 25px;
            border: 2px solid #333;
            border-radius: 15px;
            font-size: 17px;
            box-sizing: border-box;
            background: #0a0a0a;
            color: #fff;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #fff;
            background: #151515;
            box-shadow: 0 0 0 4px rgba(255,255,255,0.1);
        }
        
        label {
            color: #e0e0e0;
            font-size: 1.05rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .search-button {
            background: #fff;
            color: #0a0a0a;
            border: none;
            padding: 22px 35px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .search-button:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.7);
            background: #f5f5f5;
        }
        
        .search-button:active {
            transform: translateY(-1px);
        }
        
        .search-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .results {
            margin-top: 30px;
            display: none;
        }
        
        .ai-insights {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .resource-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            border-left: 4px solid #fff;
            transition: all 0.3s ease;
        }
        
        .resource-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border-left-color: #fff;
        }
        
        .resource-card.rank-1 {
            border-left-color: #ffd700;
            background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
        }
        
        .resource-card.rank-2 {
            border-left-color: #c0c0c0;
            background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
        }
        
        .resource-card.rank-3 {
            border-left-color: #cd7f32;
            background: linear-gradient(135deg, #fff4e6 0%, #ffffff 100%);
        }
        
        .resource-header{ 
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .resource-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }
        
        .rank-badge {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .rank-badge.rank-1 { background: #ffd700; color: #333; }
        .rank-badge.rank-2 { background: #c0c0c0; color: #333; }
        .rank-badge.rank-3 { background: #cd7f32; color: white; }
        
        .verification-badge {
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .distance-info {
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-left: 8px;
        }
        
        .relevance-score {
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .resource-info {
            margin: 10px 0;
        }
        
        .resource-info strong {
            color: #667eea;
        }
        
        .match-reason {
            background: #e3f2fd;
            color: #1976d2;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid #2196f3;
        }
        
        .actions {
            margin-top: 15px;
        }
        
        .action-button {
            display: inline-block;
            margin: 5px 10px 5px 0;
            padding: 8px 15px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .action-button:hover {
            background: #5a6fd8;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        
        .spinner {
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success-animation {
            animation: slideIn 0.5s ease-out;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .error {
            background: rgba(220, 53, 69, 0.1);
            color: #ff6b6b;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid rgba(220, 53, 69, 0.3);
        }
        
        .status {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background: #d4edda;
            color: #155724;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Impact Stats Banner -->
        <div style="background: rgba(255,255,255,0.05); padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.1);">
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #3498db; margin-bottom: 5px;">AI</div>
                    <div style="font-size: 0.85rem; color: #999;">Powered</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #9b59b6; margin-bottom: 5px;">24/7</div>
                    <div style="font-size: 0.85rem; color: #999;">Available</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #2ecc71; margin-bottom: 5px;">100%</div>
                    <div style="font-size: 0.85rem; color: #999;">Free</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #e74c3c; margin-bottom: 5px;">‚ö°</div>
                    <div style="font-size: 0.85rem; color: #999;">Fast</div>
                </div>
            </div>
        </div>

        <div class="header">
            <h1>ü§ù AidLink</h1>
            <p style="font-size: 1.2rem; color: #999; margin-bottom: 20px; font-weight: 500;">Smart Community Resource Navigator</p>
        </div>
        
        <!-- Emergency Quick Access Banner -->
        <div style="background: linear-gradient(135deg, #ff1a1a 0%, #cc0000 100%); padding: 15px 20px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 8px 25px rgba(255,0,0,0.3);">
            <p style="margin: 0; text-align: center; color: white; font-weight: 700; font-size: 0.95rem;">
                üö® <strong>Emergency?</strong> Call <a href="tel:211" style="color: white; text-decoration: underline; font-weight: 900;">2-1-1</a> or <a href="tel:988" style="color: white; text-decoration: underline; font-weight: 900;">9-8-8</a>
            </p>
        </div>
        
        <!-- Unified Search Form -->
        <form id="searchForm" class="search-form">
            <div class="form-group">
                <label for="query">What do you need help with?</label>
                <input type="text" id="query" name="query" placeholder="e.g., I need food assistance" required>
            </div>
            
            <div class="form-group">
                <label for="location">Location</label>
                <input type="text" id="location" name="location" placeholder="e.g., Sacramento, CA">
            </div>
            
            <div class="form-group">
                <label for="radius">Search Radius</label>
                <select id="radius" name="radius" style="width: 100%; padding: 15px 20px; border: 2px solid #333; border-radius: 12px; font-size: 16px; box-sizing: border-box; background: #0a0a0a; color: #fff; font-weight: 500;">
                    <option value="5">Within 5 miles (walkable + short drive)</option>
                    <option value="10" selected>Within 10 miles (standard)</option>
                    <option value="15">Within 15 miles (wider search)</option>
                    <option value="25">Within 25 miles (maximum range)</option>
                </select>
            </div>
            
            <button type="submit" class="search-button" id="searchButton">
                Find Resources
            </button>
        </form>
        
        <!-- Floating Emergency Button -->
        <div class="emergency-button" onclick="openEmergencyModal()" title="Emergency Hotlines">
            üö®
        </div>
        
        <!-- Emergency Modal -->
        <div id="emergencyModal" class="emergency-modal" onclick="closeEmergencyModal(event)">
            <div class="emergency-modal-content" onclick="event.stopPropagation()">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2 style="margin: 0; color: #fff; font-size: 2rem; font-weight: 700;">üö® Emergency Hotlines</h2>
                    <button onclick="closeEmergencyModal(event)" style="background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 8px 15px; cursor: pointer; font-size: 1.5rem; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">‚úï</button>
                </div>
                
                <div class="emergency-hotline-item">
                    <h3 style="margin: 0 0 8px 0; color: #fff; font-size: 1.2rem;">üìû 2-1-1 - Community Resources</h3>
                    <p style="margin: 0 0 10px 0; color: #ccc; font-size: 0.95rem;">Free, confidential information and referral service for health and human services</p>
                    <a href="tel:211" class="emergency-hotline-number">Call 211</a>
                </div>
                
                <div class="emergency-hotline-item">
                    <h3 style="margin: 0 0 8px 0; color: #fff; font-size: 1.2rem;">üíö 9-8-8 - Suicide & Crisis Lifeline</h3>
                    <p style="margin: 0 0 10px 0; color: #ccc; font-size: 0.95rem;">Free, 24/7 support for anyone in suicidal crisis or emotional distress</p>
                    <a href="tel:988" class="emergency-hotline-number">Call 988</a>
                </div>
                
                <div class="emergency-hotline-item">
                    <h3 style="margin: 0 0 8px 0; color: #fff; font-size: 1.2rem;">üõ°Ô∏è National Domestic Violence Hotline</h3>
                    <p style="margin: 0 0 10px 0; color: #ccc; font-size: 0.95rem;">24/7 support for people affected by domestic violence</p>
                    <a href="tel:18007997233" class="emergency-hotline-number">1-800-799-7233</a>
                </div>
                
                <div class="emergency-hotline-item">
                    <h3 style="margin: 0 0 8px 0; color: #fff; font-size: 1.2rem;">üéñÔ∏è Veterans Crisis Line</h3>
                    <p style="margin: 0 0 10px 0; color: #ccc; font-size: 0.95rem;">Free, confidential support for veterans in crisis</p>
                    <a href="tel:18002738255" class="emergency-hotline-number">1-800-273-8255</a>
                </div>
                
                <div class="emergency-hotline-item">
                    <h3 style="margin: 0 0 8px 0; color: #fff; font-size: 1.2rem;">üö® 9-1-1 - Emergency Services</h3>
                    <p style="margin: 0 0 10px 0; color: #ccc; font-size: 0.95rem;">For immediate life-threatening emergencies</p>
                    <a href="tel:911" class="emergency-hotline-number" style="background: #ff1a1a; color: #fff;">Call 911</a>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: rgba(102, 126, 234, 0.1); border-radius: 12px; border: 1px solid rgba(102, 126, 234, 0.3);">
                    <p style="margin: 0; color: #ccc; font-size: 0.9rem; line-height: 1.6;">
                        üí° <strong>Remember:</strong> These hotlines are free, confidential, and available 24/7. You are not alone.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Results area for combined eligibility + resources -->
        <div id="eligibilityResults" style="display: none; margin-top: 20px;"></div>
        
        <div id="status" class="status" style="display: none;">
            System Status: Loading...
        </div>
        
        <div id="results" class="results"></div>
    </div>
    
    <script>
        // Emergency Modal Functions
        function openEmergencyModal() {
            const modal = document.getElementById('emergencyModal');
            if (modal) {
                modal.classList.add('active');
            }
        }
        
        function closeEmergencyModal(event) {
            if (event) {
                event.stopPropagation();
            }
            const modal = document.getElementById('emergencyModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }
        
        // Close modal on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeEmergencyModal();
            }
        });
        
        const searchForm = document.getElementById('searchForm');
        const searchButton = document.getElementById('searchButton');
        const resultsDiv = document.getElementById('results');
        const statusDiv = document.getElementById('status');
        
        const eligibilityResults = document.getElementById('eligibilityResults');
        
        // Load system status
        loadStatus();
        
        // Unified form submission - runs both eligibility analysis AND resource search
        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const query = document.getElementById('query').value.trim();
            const location = document.getElementById('location').value.trim();
            
            if (!query) {
                alert('Please describe your situation');
                return;
            }
            
            // Run both eligibility analysis AND resource search in parallel
            await searchResourcesWithAI(query, location);
        });
        
        async function loadStatus() {
            try {
                const response = await fetch('/api/status');
                if (response.ok) {
                    const data = await response.json();
                }
            } catch (error) {
                console.error('Failed to load status:', error);
            }
        }
        
        async function searchResourcesWithAI(query, location) {
            try {
                showLoading();
                eligibilityResults.style.display = 'block';
                eligibilityResults.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p style="font-size: 1.2rem; font-weight: 600; margin-bottom: 10px; color: #fff;">Searching for resources...</p>
                        <p style="font-size: 1rem; color: #999; font-weight: 400;">Finding the best help for you</p>
                    </div>
                `;
                
                console.log('üîç Running AI-powered search for:', query);
                
                // Get radius setting
                const radius = parseInt(document.getElementById('radius').value) || 10;
                
                // FIRST get resources, THEN create action plan based on them
                const searchResponse = await fetch('/api/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query, location: location, max_results: 5, radius: radius })
                });
                
                const searchData = await searchResponse.json();
                
                // NOW create action plan based on actual resources found
                const eligibilityResponse = await fetch('/api/analyze-eligibility', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        situation: query, 
                        location: location,
                        resources: searchData.recommendations || []
                    })
                });
                
                const eligibilityData = await eligibilityResponse.json();
                
                console.log('‚úÖ Eligibility analysis:', eligibilityData);
                console.log('‚úÖ Resources found:', searchData);
                
                // Display combined results
                displayCombinedResults(eligibilityData, searchData);
                
            } catch (error) {
                console.error('‚ùå Search error:', error);
                eligibilityResults.innerHTML = `<div class="error">‚ùå Failed to analyze situation. Please try again. <br><small>Error: ${error.message}</small></div>`;
            } finally {
                searchButton.disabled = false;
                searchButton.textContent = 'FIND RESOURCES';
            }
        }
        
        // Helper function to escape HTML attributes
        function escapeHtmlAttr(str) {
            if (!str) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
        }
        
        function displayCombinedResults(eligibilityData, searchData) {
            let html = '';
            
            // Show Eligibility Analysis Section
            if (eligibilityData.success && eligibilityData.analysis) {
                const analysis = eligibilityData.analysis;
                
                // Summary with Dark Theme
                html += `
                    <div class="success-animation" style="background: #fff; color: #0a0a0a; padding: 30px; border-radius: 20px; margin-bottom: 25px; border: 3px solid #fff; box-shadow: 0 15px 40px rgba(0,0,0,0.4);">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                            <div style="font-size: 3rem;">üß†</div>
                            <div>
                                <h2 style="margin: 0; color: #0a0a0a; font-size: 1.8rem; font-weight: 700;">Eligibility Analysis</h2>
                                <div style="font-size: 1rem; color: #666; font-weight: 600;">‚úì Completed</div>
                            </div>
                        </div>
                        ${analysis.situation_summary ? `
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #ddd;">
                                <strong style="color: #333; font-size: 1rem;">Summary:</strong>
                                <p style="margin: 10px 0 0 0; color: #555; font-size: 1.05rem;">${analysis.situation_summary}</p>
                            </div>
                        ` : ''}
                        ${analysis.urgency_score ? `
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <strong style="color: #333;">Urgency Level:</strong>
                                <div style="flex: 1; height: 12px; background: #ddd; border-radius: 6px; overflow: hidden;">
                                    <div style="height: 100%; width: ${analysis.urgency_score * 10}%; background: ${analysis.urgency_score >= 8 ? '#ff6b6b' : analysis.urgency_score >= 5 ? '#ffa502' : '#2ecc71'}; transition: width 0.5s;"></div>
                                </div>
                                <span style="font-weight: 900; font-size: 1.2rem; color: #333;">${analysis.urgency_score}/10</span>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                // PROGRAMS YOU QUALIFY FOR - SHOW FIRST (Move to top)
                if (analysis.likely_eligible_programs && analysis.likely_eligible_programs.length > 0) {
                    html += `
                        <div style="background: linear-gradient(135deg, rgba(46, 204, 113, 0.2) 0%, rgba(39, 174, 96, 0.2) 100%); border: 2px solid rgba(46, 204, 113, 0.4); padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                            <h3 style="margin: 0 0 15px 0; color: #2ecc71; font-size: 1.3rem; font-weight: 700;">‚úì Programs You Qualify For</h3>
                            <div style="display: grid; gap: 12px;">
                                ${analysis.likely_eligible_programs.slice(0, 5).map(program => `
                                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; border: 1px solid rgba(46, 204, 113, 0.3);">
                                        <strong style="color: #fff; font-size: 1rem;">‚úì ${typeof program === 'string' ? program : program.name}</strong>
                                        ${typeof program === 'object' && program.confidence ? 
                                            ` <span style="color: #2ecc71; font-size: 0.9rem;">(${Math.round(program.confidence * 100)}% match)</span>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // Action Plan - More detailed version
                let actionPlanData = eligibilityData.action_plan;
                
                // Handle different API response structures
                if (actionPlanData && actionPlanData.action_plan && actionPlanData.action_plan.prioritized_action_plan) {
                    actionPlanData = actionPlanData.action_plan.prioritized_action_plan;
                }
                
                if (actionPlanData && actionPlanData.urgent_actions && actionPlanData.urgent_actions.length > 0) {
                    html += `
                        <div style="background: rgba(255,255,255,0.05); padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 2px solid rgba(255,255,255,0.2);">
                            <h2 style="margin: 0 0 20px 0; color: #fff; font-size: 1.4rem; font-weight: 700;">üìã Your Action Plan</h2>
                            
                            <div style="display: grid; gap: 15px;">
                    `;
                    
                    actionPlanData.urgent_actions.forEach((action, index) => {
                        const actionText = typeof action === 'string' ? action : (action.action || action.resource_name || 'Get help');
                        const phone = typeof action === 'object' && action.phone_number;
                        const address = typeof action === 'object' && action.address;
                        const why = typeof action === 'object' && action.why;
                        const timeframe = typeof action === 'object' && action.timeframe;
                        
                        // More detailed action plan
                        html += `
                            <div style="background: #0a0a0a; padding: 22px; border-radius: 12px; border: 2px solid #333;">
                                <div style="display: flex; align-items: start; gap: 15px;">
                                    <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; width: 42px; height: 42px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 1.1rem; flex-shrink: 0;">${index + 1}</span>
                                    <div style="flex: 1;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 10px; margin-bottom: 12px;">
                                            <h3 style="margin: 0; color: #fff; font-size: 1.1rem; font-weight: 700;">${actionText}</h3>
                                            ${timeframe ? `<span style="background: rgba(52, 152, 219, 0.2); color: #3498db; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; white-space: nowrap;">${timeframe}</span>` : ''}
                                        </div>
                                        ${why ? `<p style="margin: 0 0 15px 0; color: #999; font-size: 0.9rem; line-height: 1.4;">üí° ${why}</p>` : ''}
                                        
                                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">
                                            ${phone ? `
                                                <a href="tel:${phone.replace(/[^\d]/g, '')}" 
                                                   style="background: #fff; color: #0a0a0a; padding: 12px 20px; border-radius: 8px; text-decoration: none; font-weight: 700; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s; font-size: 0.95rem;"
                                                   onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.5)'"
                                                   onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                                    üìû ${phone}
                                                </a>
                                                <button class="call-script-btn" 
                                                   data-action-text="${escapeHtmlAttr(actionText)}" 
                                                   data-phone="${escapeHtmlAttr(phone)}"
                                                   style="background: rgba(102, 126, 234, 0.2); color: #667eea; padding: 12px 20px; border-radius: 8px; border: 1px solid #667eea; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s; font-size: 0.95rem; cursor: pointer;"
                                                   onmouseover="this.style.background='rgba(102, 126, 234, 0.3)'; this.style.transform='translateY(-2px)'"
                                                   onmouseout="this.style.background='rgba(102, 126, 234, 0.2)'; this.style.transform=''">
                                                    üìù Call Script
                                                </button>
                                            ` : ''}
                                            ${address ? `
                                                <a href="https://maps.google.com/?q=${encodeURIComponent(address)}" 
                                                   target="_blank"
                                                   style="background: rgba(255,255,255,0.1); color: #fff; padding: 12px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,0.2); transition: all 0.2s; font-size: 0.95rem;"
                                                   onmouseover="this.style.background='rgba(255,255,255,0.2)'"
                                                   onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                                                    üó∫Ô∏è Get Directions
                                                </a>
                                            ` : ''}
                                        </div>
                                        ${address ? `<p style="margin: 8px 0 0 0; color: #666; font-size: 0.9rem;">üìç ${address}</p>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                            
                            <!-- Transportation Tip -->
                            <div style="background: rgba(155, 89, 182, 0.15); padding: 15px; border-radius: 10px; margin-top: 15px; border: 1px solid rgba(155, 89, 182, 0.3);">
                                <p style="margin: 0; color: #9b59b6; font-weight: 600; font-size: 0.95rem;">
                                    üí° Tip: If you need transportation, call the resource and ask if they provide rides or can connect you with transportation assistance.
                                </p>
                            </div>
                        </div>
                    `;
                }
                
                // Document Checklist
                if (eligibilityData.document_checklist && eligibilityData.document_checklist.length > 0) {
                    html += `
                        <div class="document-checklist">
                            <h2 style="margin: 0 0 20px 0; color: #fff; font-size: 1.4rem; font-weight: 700;">üìÑ Documents You'll Need</h2>
                            <p style="margin: 0 0 20px 0; color: #ccc; font-size: 1rem;">Check off documents as you gather them:</p>
                            <div id="documentChecklist">
                    `;
                    
                    eligibilityData.document_checklist.forEach((doc, index) => {
                        html += `
                            <div class="document-item" data-doc-index="${index}">
                                <input type="checkbox" id="doc-${index}" onchange="toggleDocument(${index})">
                                <label for="doc-${index}" style="color: #fff; font-size: 1rem; cursor: pointer; flex: 1;">${doc}</label>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                            <div style="margin-top: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; border: 1px solid rgba(102, 126, 234, 0.3);">
                                <p style="margin: 0; color: #ccc; font-size: 0.9rem; line-height: 1.6;">
                                    üí° <strong>Tip:</strong> Don't worry if you're missing some documents. Many organizations will still help you and can guide you on how to obtain them.
                                </p>
                            </div>
                        </div>
                    `;
                }
                
            }
            
            // Show Resources Section with Beautiful Cards
            if (searchData.success && searchData.recommendations && searchData.recommendations.length > 0) {
                html += `
                    <div style="margin-top: 40px; padding-top: 25px; border-top: 2px solid rgba(255,255,255,0.1);">
                        <h2 style="color: #fff; margin-bottom: 10px; font-size: 1.8rem; font-weight: 700;">üìç Resources Near You</h2>
                        <p style="color: #999; font-size: 1rem; margin-bottom: 25px;">${searchData.recommendations.length} verified resources found</p>
                    </div>
                `;
                
                searchData.recommendations.forEach((resource, index) => {
                    const borderColor = index === 0 ? '#2ecc71' : index === 1 ? '#ffa502' : '#fff';
                    
                    html += `
                        <div class="success-animation" style="background: #0a0a0a; border: 3px solid ${borderColor}; border-radius: 20px; padding: 25px; margin-bottom: 25px; box-shadow: 0 10px 35px rgba(0,0,0,0.6); transition: all 0.3s;">
                            <div class="resource-header" style="margin-bottom: 20px;">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <span style="background: #fff; color: #0a0a0a; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 1.3rem;">${index + 1}</span>
                                    <div class="resource-name" style="font-size: 1.4rem; flex: 1; color: #fff; font-weight: 600;">${resource.name}</div>
                                    ${index < 3 ? `<span style="background: ${borderColor}; color: ${index === 0 ? '#000' : '#fff'}; padding: 6px 15px; border-radius: 25px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase;">TOP</span>` : ''}
                                </div>
                            </div>
                            
                            <div class="resource-info" style="margin-bottom: 20px;">
                                <p style="margin: 0 0 12px 0; color: #999; font-size: 1rem; line-height: 1.5;">${resource.description || 'Community resource'}</p>
                                
                                ${resource.services ? `
                                    <div style="background: rgba(52, 152, 219, 0.1); padding: 12px 15px; border-radius: 8px; margin-bottom: 12px; border: 1px solid rgba(52, 152, 219, 0.3);">
                                        <p style="margin: 0; color: #3498db; font-weight: 600; font-size: 0.9rem; margin-bottom: 6px;">üíº Services Provided:</p>
                                        <p style="margin: 0; color: #fff; font-size: 0.95rem;">${resource.services}</p>
                                    </div>
                                ` : ''}
                                
                                <p style="margin: 8px 0; display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.2rem;">üìç</span> 
                                    <span style="color: #fff;">${resource.address}</span>
                                </p>
                                <p style="margin: 8px 0; display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.2rem;">üìû</span> 
                                    <a href="tel:${resource.phone}" style="color: #fff; text-decoration: none; font-weight: 700; font-size: 1.1rem;">${resource.phone}</a>
                                </p>
                                <p style="margin: 8px 0; color: #666; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.1rem;">üïê</span> ${resource.hours}
                                </p>
                                ${resource.transportation ? `
                                    <div style="background: rgba(155, 89, 182, 0.15); padding: 10px 15px; border-radius: 8px; margin-top: 8px; border: 1px solid rgba(155, 89, 182, 0.3);">
                                        <p style="margin: 0; color: #9b59b6; font-weight: 600; font-size: 0.9rem; margin-bottom: 4px;">üöó Getting There:</p>
                                        <p style="margin: 0; color: #fff; font-size: 0.95rem;">${resource.transportation}</p>
                                    </div>
                                ` : ''}
                                ${resource.rating ? `
                                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                        <span style="color: #ffc107; font-size: 1.1rem;">‚≠ê ${resource.rating}/5.0</span>
                                        ${resource.reviews ? `<span style="color: #999; font-size: 0.9rem;">(${resource.reviews} reviews)</span>` : '<span style="color: #999; font-size: 0.9rem;">Verified</span>'}
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="actions" style="display: flex; gap: 12px; flex-wrap: wrap;">
                                ${resource.phone ? `
                                    <a href="tel:${resource.phone.replace(/[^\d]/g, '')}" 
                                       style="background: #fff; color: #0a0a0a; padding: 15px 30px; border-radius: 10px; text-decoration: none; font-weight: 700; font-size: 1rem; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px;"
                                       onmouseover="this.style.transform='translateY(-3px)'; this.style.background='#f5f5f5'"
                                       onmouseout="this.style.transform=''; this.style.background='#fff'">
                                        üìû Call Now
                                    </a>
                                ` : ''}
                                ${resource.website ? `
                                    <a href="${resource.website}" target="_blank"
                                       style="background: rgba(255,255,255,0.1); color: #fff; padding: 15px 30px; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 1rem; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,0.2);"
                                       onmouseover="this.style.background='rgba(255,255,255,0.2)'"
                                       onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                                        üåê Website
                                    </a>
                                ` : ''}
                                <a href="https://maps.google.com/?q=${encodeURIComponent(resource.address)}" target="_blank"
                                   style="background: rgba(255,255,255,0.1); color: #fff; padding: 15px 30px; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 1rem; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,0.2);"
                                   onmouseover="this.style.background='rgba(255,255,255,0.2)'"
                                   onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                                    üó∫Ô∏è Get Directions
                                </a>
                            </div>
                        </div>
                    `;
                });
            }
            
            // Add Social Impact Footer - Dark Theme
            html += `
                <div style="background: rgba(255,255,255,0.05); padding: 30px; border-radius: 20px; margin-top: 40px; text-align: center; border: 2px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 3rem; margin-bottom: 15px;">‚úÖ</div>
                    <p style="font-weight: 700; color: #fff; margin-bottom: 10px; font-size: 1.2rem;">Your action plan is ready</p>
                    <p style="font-size: 0.95rem; color: #999; margin-bottom: 0;">üõ°Ô∏è Verified Resources | üìä Impact Tracking</p>
                </div>
            `;
            
            eligibilityResults.innerHTML = html;
            
            // Attach event listeners for call script buttons
            document.querySelectorAll('.call-script-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const actionText = this.getAttribute('data-action-text');
                    const phone = this.getAttribute('data-phone');
                    showCallScript(0, actionText, phone);
                });
            });
        }
        
        function displayResults(data) {
            try {
                searchButton.disabled = false;
                searchButton.textContent = 'FIND RESOURCES';
                
                if (!data || !data.recommendations || data.recommendations.length === 0) {
                    showError('No resources found for your query. Try different keywords.');
                    return;
                }
                
                let html = '';
            
            // AI insights
            if (data.suggested_response) {
                html += `
                    <div class="ai-insights">
                        <strong>üìã Recommendation:</strong> ${data.suggested_response}<br>
                        <small>
                            Category: ${data.category} | 
                            Urgency: ${data.urgency || 'medium'} | 
                            Location: ${data.location || 'not specified'}${data.location_filtered ? ' üó∫Ô∏è (Distance Filtered)' : ''} | 
                            Confidence: ${Math.round(data.confidence * 100)}% | 
                            Model: ${data.ai_model}
                        </small>
                        ${data.enhanced_prompt ? `<br><small><strong>Enhanced Prompt:</strong> ${data.enhanced_prompt}</small>` : ''}
                        
                        ${data.verification ? `
                            <br><small>
                                <strong>üõ°Ô∏è Verification:</strong> 
                                ${data.verification.enabled ? 
                                    (data.verification.status === 'verified' ? '‚úÖ Verified Resources' : 
                                     data.verification.status === 'real_data_fallback' ? 'üõ°Ô∏è Real Verified Data Sources' :
                                     data.verification.status === 'warning' ? '‚ö†Ô∏è Some Resources Filtered' : 
                                     'üîç Verification Disabled') : 
                                    'üîç Not Available'
                                }
                                ${data.verification.summary ? 
                                    ` | Quality Score: ${Math.round(data.verification.summary.average_quality_score * 100)}% | Passed: ${data.verification.summary.passed_verification}/${data.verification.summary.total_resources}` : 
                                    ''
                                }
                            </small>
                        ` : ''}
                    </div>
                `;
            }
            
            // Results
            html += `<h2>üìã Recommended Resources (${data.recommendations.length} found)</h2>`;
            
            data.recommendations.forEach((resource, index) => {
                const rank = resource.rank || (index + 1);
                const relevanceScore = resource.relevance_score || 0.8;
                const matchReason = resource.match_reason || "Recommended based on your query";
                
                html += `
                    <div class="resource-card rank-${rank}">
                        <div class="resource-header">
                            <div class="resource-name">${resource.name}</div>
                            <div>
                                <span class="rank-badge rank-${rank}">${rank}</span>
                                <span class="relevance-score">${Math.round(relevanceScore * 100)}% match</span>
                                ${resource.verification && resource.verification.verified ? 
                                    `<span class="verification-badge">üõ°Ô∏è Verified</span>` : 
                                    ''
                                }
                            </div>
                        </div>
                        
                        <div class="resource-info">
                            <p><strong>Category:</strong> ${resource.category}</p>
                            <p><strong>Description:</strong> ${resource.description}</p>
                            <p><strong>Address:</strong> ${resource.address}${resource.distance ? ` <span class="distance-info">üìç ${resource.distance} miles away</span>` : ''}</p>
                            <p><strong>Phone:</strong> ${resource.phone}</p>
                            <p><strong>Hours:</strong> ${resource.hours}</p>
                            <p><strong>Eligibility:</strong> ${resource.eligibility}</p>
                            ${resource.services ? 
                                `<p><strong>Services:</strong> ${typeof resource.services === 'string' ? resource.services : resource.services.join(', ')}</p>` : ''}
                        </div>
                        
                        <div class="match-reason">
                            <strong>üí° Why this matches:</strong> ${matchReason}
                        </div>
                        
                        <div class="actions">
                            ${resource.phone ? `<a href="tel:${resource.phone}" class="action-button">üìû Call</a>` : ''}
                            ${resource.website ? `<a href="${resource.website}" target="_blank" class="action-button">üåê Website</a>` : ''}
                            <a href="https://maps.google.com/?q=${encodeURIComponent(resource.address)}" target="_blank" class="action-button">üó∫Ô∏è Directions</a>
                        </div>
                    </div>
                `;
            });
            
                resultsDiv.innerHTML = html;
                resultsDiv.style.display = 'block';
            } catch (error) {
                console.error('‚ùå Display results error:', error);
                showError('Failed to display results. Please try again.');
            }
        }
        
        function showLoading() {
            searchButton.disabled = true;
            searchButton.textContent = 'Analyzing...';
            searchButton.style.opacity = '0.7';
            resultsDiv.style.display = 'none';
        }
        
        function showError(message) {
            searchButton.disabled = false;
            searchButton.textContent = 'FIND RESOURCES';
            searchButton.style.opacity = '1';
            eligibilityResults.innerHTML = `
                <div style="background: rgba(220, 53, 69, 0.1); border: 2px solid rgba(220, 53, 69, 0.3); color: #ff6b6b; padding: 20px; border-radius: 15px; margin-top: 20px;">
                    <p style="margin: 0; font-weight: 600; font-size: 1.1rem;">‚ùå ${message}</p>
                </div>
            `;
            eligibilityResults.style.display = 'block';
        }
        
        // Share Action Plan function
        function shareActionPlan() {
            const actionPlan = document.getElementById('eligibilityResults');
            if (!actionPlan) {
                alert('No action plan to share');
                return;
            }
            
            const planText = actionPlan.innerText;
            const shareText = `üöÄ My Personalized Action Plan from AidLink:\n\n${planText}\n\nGenerated by AidLink - AI-Powered Community Resource Navigator`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'My AidLink Action Plan',
                    text: shareText,
                    url: window.location.href
                }).catch(err => console.log('Share error:', err));
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('‚úÖ Action plan copied to clipboard!');
                }).catch(() => {
                    alert('Action Plan:\n\n' + shareText);
                });
            }
        }
        
        // Export Action Plan to PDF
        function exportActionPlan() {
            const actionPlan = document.getElementById('eligibilityResults');
            if (!actionPlan) {
                alert('No action plan to export');
                return;
            }
            
            window.print();
        }
        
        // Generate call script based on action type
        function generateCallScript(actionText, phone) {
            const actionLower = actionText.toLowerCase();
            let script = [];
            
            // Opening
            script.push("When they answer, say:");
            script.push(`"Hello, I'm calling about ${actionText.toLowerCase()}."`);
            script.push("");
            
            // Questions based on action type
            if (actionLower.includes('food') || actionLower.includes('hunger') || actionLower.includes('eat')) {
                script.push("Ask:");
                script.push('"What documents do I need to apply?"');
                script.push('"What are your hours?"');
                script.push('"Do you offer emergency food assistance today?"');
                script.push('"Is there a waiting list?"');
                script.push('"Do you provide transportation or delivery?"');
            } else if (actionLower.includes('housing') || actionLower.includes('shelter') || actionLower.includes('home')) {
                script.push("Ask:");
                script.push('"Do you have emergency shelter available?"');
                script.push('"What are the eligibility requirements?"');
                script.push('"What documents do I need to bring?"');
                script.push('"How long can I stay?"');
                script.push('"Do you help with permanent housing?"');
            } else if (actionLower.includes('211') || actionLower.includes('assistance')) {
                script.push("Ask:");
                script.push('"I need help finding resources. Can you assist me?"');
                script.push('"What programs am I eligible for?"');
                script.push('"Can you help me apply?"');
                script.push('"What documents should I prepare?"');
            } else {
                // Generic questions
                script.push("Ask:");
                script.push('"What services do you offer?"');
                script.push('"What are the requirements to qualify?"');
                script.push('"What documents do I need?"');
                script.push('"What are your hours?"');
                script.push('"How do I apply?"');
            }
            
            script.push("");
            script.push("Before hanging up:");
            script.push('"Thank you so much for your help."');
            script.push("");
            script.push(`üí° Tip: Write down their answers. Ask for a reference number if they give you one.`);
            
            return script.join("\n");
        }
        
        // Show call script modal
        function showCallScript(index, actionText, phone) {
            const script = generateCallScript(actionText, phone);
            
            // Create modal
            const modal = document.createElement('div');
            modal.id = 'callScriptModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: #0a0a0a; border: 2px solid #667eea; border-radius: 20px; padding: 30px; max-width: 600px; width: 100%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.9);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0; color: #fff; font-size: 1.5rem; font-weight: 700;">üìù Call Script</h2>
                        <button onclick="closeCallScript()" style="background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 8px 15px; cursor: pointer; font-size: 1.2rem; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">‚úï</button>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1);">
                        <p style="margin: 0 0 10px 0; color: #667eea; font-weight: 700; font-size: 1.1rem;">Calling: ${phone}</p>
                        <p style="margin: 0; color: #999; font-size: 0.95rem;">Action: ${actionText}</p>
                    </div>
                    
                    <div style="background: #0a0a0a; padding: 20px; border-radius: 12px; border: 2px solid #333; margin-bottom: 20px;">
                        <pre id="callScriptText" style="color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 1rem; line-height: 1.6; white-space: pre-wrap; margin: 0;">${script}</pre>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="copyCallScript()" style="flex: 1; background: #667eea; color: #fff; padding: 14px; border: none; border-radius: 10px; font-weight: 700; font-size: 1rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#5a6fd8'" onmouseout="this.style.background='#667eea'">
                            üìã Copy Script
                        </button>
                        <a href="tel:${phone.replace(/[^\d]/g, '')}" style="flex: 1; background: #fff; color: #0a0a0a; padding: 14px; border-radius: 10px; font-weight: 700; font-size: 1rem; text-decoration: none; text-align: center; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform=''">
                            üìû Call Now
                        </a>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close on click outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeCallScript();
                }
            });
        }
        
        // Close call script modal
        function closeCallScript() {
            const modal = document.getElementById('callScriptModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Copy call script to clipboard
        function copyCallScript() {
            const scriptText = document.getElementById('callScriptText');
            if (scriptText) {
                navigator.clipboard.writeText(scriptText.textContent).then(() => {
                    const button = event.target;
                    const originalText = button.textContent;
                    button.textContent = '‚úÖ Copied!';
                    button.style.background = '#2ecc71';
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.style.background = '#667eea';
                    }, 2000);
                }).catch(() => {
                    alert('Could not copy to clipboard. Please select and copy manually.');
                });
            }
        }
        
        // Toggle document checklist item
        function toggleDocument(index) {
            const checkbox = document.getElementById(`doc-${index}`);
            const item = document.querySelector(`[data-doc-index="${index}"]`);
            
            if (checkbox && item) {
                if (checkbox.checked) {
                    item.classList.add('checked');
                } else {
                    item.classList.remove('checked');
                }
            }
        }
        
    </script>
</body>
</html>
